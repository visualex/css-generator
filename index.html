<!DOCTYPE html>
<html>
<head>
   <title>Css Generator</title>
   <link rel="stylesheet" type="text/css" href="./src/css/blaze.css">
   <link rel="stylesheet" type="text/css" href="./src/css/main.css">

   <!-- Insert this line above script imports  -->
   <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>

   <!-- normal script imports etc  -->
   <script src="./src/js/jquery-1.10.2.min.js"></script>
   <script src="./src/js/generator.js"></script>

   <!-- Insert this line after script imports -->
   <script>if (window.module) module = window.module;</script>

</head>
<body>

   <div class="window">

      <div class="prompt">
         <div class="title"></div>
         <div class="input">
            <input type="text"/>
         </div>
         <div class="buttons">
            <button></button>
         </div>
      </div>

      <div class="toolbar">
         <button class="generate">Generate CSS</button>
         <button class="open">Open ...</button>
      </div>
      <div class="panel_left">
         <pre id="editor"></pre>
      </div>
      <div class="panel_right">
         <pre></pre>
      </div>
      <div class="clear"></div>
   </div>

   <script src="./src/js/ace/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
   <script>
      var editor = ace.edit("editor");
      editor.setTheme("ace/theme/twilight");
      editor.session.setMode("ace/mode/html");
   </script>
   <script type="text/javascript">

      var tidy = require("tidy-html5").tidy_html5;
      var app = require('electron').remote;
      var dialog = app.dialog;
      var fs = require('fs'); // Load the File System to execute our common tasks (CRUD)


      function cssSetContent(content)
      {
         $('.panel_right pre').text(content);
      }

      function editorSetContent(content)
      {
         editor.setValue(content);
         return content;
      }

      function editorGetContent()
      {
         return editor.getValue();
      }

      function tidyContent(content)
      {
         tidyHtml = tidy(content, {"indent-spaces": 4});
         return tidyHtml.replace(/^[\S\s]*<body[^>]*?>/i, "").replace(/<\/body[\S\s]*$/i, "");
      }

      function generateCss()
      {
         html = editorSetContent(tidyContent(editorGetContent()));
         html = $( '<div>' + html + '</div>' ).children();
         $(html).cssGenerator({prefer_ids_over_class:false, callback:cssSetContent});
      }

      function openUrl()
      {
         url = prompt('URL');
      }

      function prompt(message)
      {
         console.log(message);
      }

      $(document).ready(function(){
         // UI events
         $('.toolbar button.generate').click(function(){ generateCss(); });
         $('.toolbar button.open').click(function(){ openUrl(); });

      });
   </script>
</body>
</html>