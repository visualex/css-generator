<!DOCTYPE html>
<html>
<head>
   <title>Css Generator</title>
   <style type="text/css">
   *{    margin: 0;    padding: 0;}
   body,html{    height: 100%;    background: #212121; overflow:hidden;}
   .window {    height: 100%;}
   .window .toolbar {    height: 5%;}
   .window .toolbar .css_selector {    background-color: #5F5D5D;    float: left;    height: 100%;    border: none;    width: 50%;}
   .window .toolbar button {
      background: #ac7d3e;
      float: right;
      border: none;
      height: 100%;
      padding: 10px;
      line-height: 0;
      color: white;
      border-right: solid 1px #212121;
   }
   .window .panel_left {    height: 95%;    float: left;    width: 50%;}
   .window .panel_left pre{height:100%;}
   /*.window .panel_left textarea {    border: solid 1px #504F4F;    color: #199219;    background: black;    width: 100%;    height: 100%;}*/
   .window .panel_right {    height: 95%;    float: left;    width: 50%;}
   .window .panel_right pre {    background: #1D1D1D;    height: 100%;    overflow: auto;    color: #E49300;}
   .window .clear {}
   </style>

   <!-- Insert this line above script imports  -->
   <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>

   <!-- normal script imports etc  -->
   <script src="./src/js/jquery-1.10.2.min.js"></script>
   <script src="./src/js/generator.js"></script>

   <!-- Insert this line after script imports -->
   <script>if (window.module) module = window.module;</script>

</head>
<body>

   <div class="window">
      <div class="toolbar">
         <button class="generate">Generate CSS</button>
         <button class="open">Open ...</button>
      </div>
      <div class="panel_left">
         <pre id="editor"></pre>
      </div>
      <div class="panel_right">
         <pre></pre>
      </div>
      <div class="clear"></div>
   </div>

   <script src="./src/js/ace/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
   <script>
      var editor = ace.edit("editor");
      editor.setTheme("ace/theme/twilight");
      editor.session.setMode("ace/mode/html");
   </script>
   <script type="text/javascript">

      var tidy = require("tidy-html5").tidy_html5;
      var app = require('electron').remote;
      var dialog = app.dialog;
      var fs = require('fs'); // Load the File System to execute our common tasks (CRUD)


      function cssSetContent(content)
      {
         $('.panel_right pre').text(content);
      }

      function editorSetContent(content)
      {
         editor.setValue(content);
         return content;
      }

      function editorGetContent()
      {
         return editor.getValue();
      }

      function tidyContent(content)
      {
         tidyHtml = tidy(content, {"indent-spaces": 4});
         return tidyHtml.replace(/^[\S\s]*<body[^>]*?>/i, "").replace(/<\/body[\S\s]*$/i, "");
      }

      function generateCss()
      {
         html = editorSetContent(tidyContent(editorGetContent()));
         html = $( '<div>' + html + '</div>' ).children();
         $(html).cssGenerator({prefer_ids_over_class:false, callback:cssSetContent});
      }

      function openUrl()
      {
         url = prompt('URL');
      }

      function prompt(message)
      {
         console.log(message);
      }

      $(document).ready(function(){
         // UI events
         $('.toolbar button.generate').click(function(){ generateCss(); });
         $('.toolbar button.open').click(function(){ openUrl(); });

      });
   </script>
</body>
</html>